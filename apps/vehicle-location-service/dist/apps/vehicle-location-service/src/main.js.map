{
  "version": 3,
  "sources": ["../../../../src/main.ts"],
  "sourcesContent": ["import * as grpc from '@grpc/grpc-js';\nimport * as protoLoader from '@grpc/proto-loader';\nimport { VehicleLocationTypes } from '@io/grpc-types';\nimport { join } from 'path';\nimport { workspaceRoot } from '@nx/devkit';\n\nconst packageDef = protoLoader.loadSync(\n  join(workspaceRoot, 'libs/grpc-types/src/proto', 'vehicle-location.proto')\n);\nconst grpcObject = grpc.loadPackageDefinition(packageDef);\n\nconst vehicleLocationPackage = grpcObject.vehicle_location as grpc.GrpcObject;\nconst VehicleLocationService =\n  vehicleLocationPackage.VehicleLocationService as grpc.ServiceClientConstructor & {\n    service: grpc.ServiceDefinition;\n  };\n\nconst server = new grpc.Server();\n\n// In-memory store for vehicle locations (in a real app, you'd use a database)\nconst vehicleLocationStore = new Map<string, VehicleLocationTypes.VehicleLocation>();\n\nserver.addService(VehicleLocationService.service, {\n  SendVehicleLocation: (\n    call: grpc.ServerUnaryCall<VehicleLocationTypes.VehicleLocationRequest, VehicleLocationTypes.VehicleLocationReply>,\n    callback: grpc.sendUnaryData<VehicleLocationTypes.VehicleLocationReply>\n  ) => {\n    const request = call.request;\n\n    if (!request.vehicleLocations) {\n      callback({\n        code: grpc.status.INVALID_ARGUMENT,\n        message: 'Vehicle location data is required',\n      });\n      return;\n    }\n\n    const vehicleLocation = request.vehicleLocations;\n\n    // Validate required fields\n    if (\n      !vehicleLocation.vehicleId ||\n      !vehicleLocation.routeId ||\n      !vehicleLocation.latitude ||\n      !vehicleLocation.longitude\n    ) {\n      callback({\n        code: grpc.status.INVALID_ARGUMENT,\n        message: 'Vehicle ID, Route ID, latitude, and longitude are required',\n      });\n      return;\n    }\n\n    const now = new Date().toISOString();\n    // Store the vehicle location\n    vehicleLocationStore.set(vehicleLocation.vehicleId, {\n      ...vehicleLocation,\n    });\n\n    console.log(\n      `Updated location for vehicle ${vehicleLocation.vehicleId} on route ${vehicleLocation.routeId}:`\n    );\n    console.log(\n      `  Position: ${vehicleLocation.latitude}, ${vehicleLocation.longitude}`\n    );\n    console.log(`  Timestamp: ${now}`);\n    console.log(`  Total tracked vehicles: ${vehicleLocationStore.size}`);\n\n    // Return success status\n    callback(null, { status: 200 });\n  },\n});\n\nserver.bindAsync(\n  '0.0.0.0:50051',\n  grpc.ServerCredentials.createInsecure(),\n  (error, port) => {\n    if (error) {\n      console.error('Failed to start gRPC server:', error);\n      return;\n    }\n    console.log(`Vehicle Location Service running on port ${port}`);\n    console.log('Ready to receive vehicle location updates...');\n  }\n);\n\n// Graceful shutdown\nprocess.on('SIGINT', () => {\n  console.log('\\nShutting down Vehicle Location Service...');\n  server.tryShutdown(() => {\n    console.log('Server shut down gracefully');\n    process.exit(0);\n  });\n});\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;;;;AAAA,WAAsB;AACtB,kBAA6B;AAE7B,kBAAqB;AACrB,oBAA8B;AAE9B,MAAM,aAAa,YAAY;AAAA,MAC7B,kBAAK,6BAAe,6BAA6B,wBAAwB;AAC3E;AACA,MAAM,aAAa,KAAK,sBAAsB,UAAU;AAExD,MAAM,yBAAyB,WAAW;AAC1C,MAAM,yBACJ,uBAAuB;AAIzB,MAAM,SAAS,IAAI,KAAK,OAAO;AAG/B,MAAM,uBAAuB,oBAAI,IAAkD;AAEnF,OAAO,WAAW,uBAAuB,SAAS;AAAA,EAChD,qBAAqB,CACnB,MACA,aACG;AACH,UAAM,UAAU,KAAK;AAErB,QAAI,CAAC,QAAQ,kBAAkB;AAC7B,eAAS;AAAA,QACP,MAAM,KAAK,OAAO;AAAA,QAClB,SAAS;AAAA,MACX,CAAC;AACD;AAAA,IACF;AAEA,UAAM,kBAAkB,QAAQ;AAGhC,QACE,CAAC,gBAAgB,aACjB,CAAC,gBAAgB,WACjB,CAAC,gBAAgB,YACjB,CAAC,gBAAgB,WACjB;AACA,eAAS;AAAA,QACP,MAAM,KAAK,OAAO;AAAA,QAClB,SAAS;AAAA,MACX,CAAC;AACD;AAAA,IACF;AAEA,UAAM,OAAM,oBAAI,KAAK,GAAE,YAAY;AAEnC,yBAAqB,IAAI,gBAAgB,WAAW;AAAA,MAClD,GAAG;AAAA,IACL,CAAC;AAED,YAAQ;AAAA,MACN,gCAAgC,gBAAgB,SAAS,aAAa,gBAAgB,OAAO;AAAA,IAC/F;AACA,YAAQ;AAAA,MACN,eAAe,gBAAgB,QAAQ,KAAK,gBAAgB,SAAS;AAAA,IACvE;AACA,YAAQ,IAAI,gBAAgB,GAAG,EAAE;AACjC,YAAQ,IAAI,6BAA6B,qBAAqB,IAAI,EAAE;AAGpE,aAAS,MAAM,EAAE,QAAQ,IAAI,CAAC;AAAA,EAChC;AACF,CAAC;AAED,OAAO;AAAA,EACL;AAAA,EACA,KAAK,kBAAkB,eAAe;AAAA,EACtC,CAAC,OAAO,SAAS;AACf,QAAI,OAAO;AACT,cAAQ,MAAM,gCAAgC,KAAK;AACnD;AAAA,IACF;AACA,YAAQ,IAAI,4CAA4C,IAAI,EAAE;AAC9D,YAAQ,IAAI,8CAA8C;AAAA,EAC5D;AACF;AAGA,QAAQ,GAAG,UAAU,MAAM;AACzB,UAAQ,IAAI,6CAA6C;AACzD,SAAO,YAAY,MAAM;AACvB,YAAQ,IAAI,6BAA6B;AACzC,YAAQ,KAAK,CAAC;AAAA,EAChB,CAAC;AACH,CAAC;",
  "names": []
}
