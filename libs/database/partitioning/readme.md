## install the following extension in vscode / cursor:

https://open-vsx.org/extension/mtxr/sqltools
SqlTools

## PostgreSQL Partitioning Lab (Users by Continent)

Follow these steps in order. Keep the terminal open. Use simple copy/paste.

### 1) Start PostgreSQL with Docker

Requirements: Docker is already installed and running.

Pull the image (optional but harmless):

```bash
docker pull postgres:16
```

Start a PostgreSQL container named `pg` on port `5432` with a password:

```bash
docker run -d \
  --name pg \
  -e POSTGRES_PASSWORD=postgres \
  -p 5432:5432 \
  postgres:16
```

Wait until it is ready:

```bash
docker logs -f pg
```

When you see "database system is ready to accept connections", press Ctrl+C to stop following the logs.

If port 5432 is busy, use another host port (for example `-p 5433:5432`) and remember that for connections.

### 2) Open the PostgreSQL shell (psql)

Connect using `psql` inside the container:

```bash
docker exec -it pg psql -U postgres
```

You should see a prompt like: `postgres=#`

Helpful psql tips:

- `\l` lists databases
- `\c demo` connects to a database named `demo`
- `\dt` lists tables
- `\q` exits psql

### 3) Create a sample database

Run these inside psql:

```sql
CREATE DATABASE demo;
\c demo;
```

### 4) Create a partitioned table: users (partition key: continent)

We will partition by continent using LIST partitioning.

Run inside psql:

```sql
CREATE TABLE users (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY,
  name TEXT NOT NULL,
  email TEXT NOT NULL,
  continent TEXT NOT NULL,
  created_at TIMESTAMPTZ NOT NULL DEFAULT now(),
  CONSTRAINT users_pk PRIMARY KEY (continent, id),
  CONSTRAINT users_email_unique UNIQUE (continent, email)
) PARTITION BY LIST (continent);

-- Create one partition per continent
CREATE TABLE users_africa          PARTITION OF users FOR VALUES IN ('Africa');
CREATE TABLE users_antarctica      PARTITION OF users FOR VALUES IN ('Antarctica');
CREATE TABLE users_asia            PARTITION OF users FOR VALUES IN ('Asia');
CREATE TABLE users_europe          PARTITION OF users FOR VALUES IN ('Europe');
CREATE TABLE users_north_america   PARTITION OF users FOR VALUES IN ('North America');
CREATE TABLE users_south_america   PARTITION OF users FOR VALUES IN ('South America');
CREATE TABLE users_oceania         PARTITION OF users FOR VALUES IN ('Oceania');

-- (Optional but recommended) A default partition catches any other values
CREATE TABLE users_other PARTITION OF users DEFAULT;
```

Note: PostgreSQL requires any PRIMARY KEY or UNIQUE constraint on a partitioned table to include the partition key (`continent`). The composite constraints above satisfy that rule.

See the partitions:

```sql
\d+ users
```

### 5) Insert sample data

Run inside psql:

```sql
INSERT INTO users (name, email, continent) VALUES
  ('Ama',      'ama@example.com',       'Africa'),
  ('Li Wei',   'liwei@example.com',     'Asia'),
  ('Marie',    'marie@example.com',     'Europe'),
  ('John',     'john@example.com',      'North America'),
  ('Lucia',    'lucia@example.com',     'South America'),
  ('Noa',      'noa@example.com',       'Oceania'),
  ('Penguin',  'penguin@example.com',   'Antarctica');

-- This one is not a real continent; it should land in users_other (the default partition)
INSERT INTO users (name, email, continent) VALUES
  ('Unknown',  'unknown@example.com',   'Atlantis');
```

### 6) Validate using SQLTools (no SQL needed)

Use the SQLTools extension in VSCode/Cursor:

1. Open the SQLTools connection to your `demo` database.
2. Expand `public` → `Tables`. You should see `users` and the partition tables like `users_europe`, `users_asia`, etc., plus `users_other`.
3. Right‑click a partition table (for example `users_europe`) → "Show Records" to view the rows.
4. Confirm that each inserted user appears in the partition that matches their `continent`.
5. Confirm that the `Atlantis` row appears in `users_other` (the default partition).

You’re done!
